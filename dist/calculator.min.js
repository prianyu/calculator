!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Calculator=t()}(this,function(){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}return function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._symbols={},this._definedOperator("+",this.last,"prefix",3),this._definedOperator("-",this.negation,"prefix",3),this._definedOperator("+",this.add,"infix",2),this._definedOperator("-",this.sub,"infix",2),this._definedOperator("*",this.multi,"infix",4),this._definedOperator("/",this.div,"infix",4),this._definedOperator("(",this.last,"prefix"),this._definedOperator(")",null,"postfix"),this._definedOperator("|",this.mod,"infix",4),this._definedOperator("!",this.fac,"postfix",6),this._definedOperator("^",Math.pow,"infix",5,!0),this._definedOperator("min",Math.min),this._definedOperator("max",Math.max),this._definedOperator(",",Array.of,"infix",1),this._definedOperator("%",this.rate,"postfix",6),this._definedOperator("cos",Math.cos),this._definedOperator("sin",Math.sin),this._definedOperator("tan",Math.tan),this._definedOperator("abs",Math.abs),this._definedOperator("log",this.log),this._definedOperator("//",this.sqrt,"infix",4),this.definedOperators(e.operators||[]),this.handleError="function"==typeof e.handleError?e.handleError:null,this._caches={}}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(t,[{key:"calcReg",value:function(){var e="\\d+(?:\\.\\d+)?|"+Object.values(this._symbols).sort(function(e,t){return t.symbol.length-e.symbol.length}).map(function(e){return e.symbol.replace(/[\\*+^()$?.{}|[\]]/g,"\\$&")}).join("|")+"|(\\S)";this.pattern=new RegExp(e,"g")}},{key:"_definedOperator",value:function(e,t,n,r,i){var o,a=2<arguments.length&&void 0!==n?n:"func",s=3<arguments.length&&void 0!==r?r:0,f=4<arguments.length&&void 0!==i&&i;"func"===a&&(s=0);var h="infix"===a?2:1;this._symbols[e]=Object.assign({},this._symbols[e],(c(o={},a,{symbol:e,handle:t?t.bind(this):t,precedence:s,argCount:h,type:a,right2left:f}),c(o,"symbol",e),o))}},{key:"definedOperators",value:function(e){var n=this;(e=Array.isArray(e)?e:[e]).map(function(e){if(-1===["(",")",","].indexOf(e.token)&&e.token&&e.func){var t=n._symbols[e.token];t&&(t.infix&&"postfix"===e.type||t.postfix&&"infix"===e.type)?console.warn("".concat(e.token,": infix and postfix operator should be mutually exclusive")):n._definedOperator(e.token,e.func,e.type,e.weight,e.rtol)}}),this.calcReg()}},{key:"parse",value:function(o){function e(e){var t;return"("!=e.symbol&&f.push(e),i.push(e.handle.apply(e,p((t=[]).concat.apply(t,p(i.splice(-e.argCount)))))),e.precedence}var a,t,s=this,n=this.handleError||function(e,t){var n=a?a.index:o.length,r="[error code:".concat(e,"] ").concat(t," at ").concat(n,":\n").concat(o,"\n").concat(" ".repeat(n),"^");console.warn("".concat(r));var i={code:e,message:t};return s._caches[o].err=i},r=[this._symbols["("].prefix],i=[],f=[],h=!1;o=o.replace(/\s/g,"");var c=this._caches[o];if(c)return c.err?n(c.err.code,c.err.message):c;this._caches[o]={},this.pattern.lastIndex=0;do{t=(a=this.pattern.exec(o))?a[0]:")";var u=this._symbols[t];if(a&&a[1])return n(1001,"".concat(a[1]," is undefined"));if(!h&&isNaN(t)&&(!u||u&&!u.prefix&&!u.func))return n(1002,"Syntax error");if(h){var l=u.postfix||u.infix;do{var d=r[r.length-1];if(0<(l.precedence-d.precedence||d.right2left))break}while(e(r.pop()));h=")"!=l.symbol?"postfix"===l.type?(e(l),!0):(r.push(l),!1):"postfix"===l.type}else if(isNaN(+t)){if(r.push(u.prefix||u.func),u.func&&(!(a=this.pattern.exec(o))||"("!==a[0]))return n(1003,'Missing a opening parenthesis after function "'.concat(t,'"'))}else h=!0,i.push(+t),f.push(+t)}while(a&&r.length);return r.length?n(1004,"Opening parenthesis is more than closing parenthesis"):a?n(1005,"Closing parenthesis is more than opening parenthesis"):this._caches[o]={notation:f,value:i.pop()}}},{key:"last",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.pop()}},{key:"negation",value:function(e){return-e}},{key:"add",value:function(e,t){return e+t}},{key:"sub",value:function(e,t){return e-t}},{key:"multi",value:function(e,t){return e*t}},{key:"div",value:function(e,t){return 0===t?(this.handleError&&this.handleError({code:1006,message:"The divisor cannot be zero"}),1/0):e/t}},{key:"mod",value:function(e,t){return 0===t?(this.handleError&&this.handleError({code:1006,message:"The divisor cannot be zero"}),1/0):e%t}},{key:"fac",value:function(e){if(e%1||!(0<=+e))return NaN;if(170<e)return 1/0;for(var t=1;1<e;)t*=e--;return t}},{key:"log",value:function(e,t){return e<=0||1==e?(this.handleError&&this.handleError({code:1007,message:"The base number of logarithmic operations must be greater than 0 and not equal to 1"}),NaN):Math.log(t)/Math.log(e)}},{key:"rate",value:function(e){return e/100}},{key:"sqrt",value:function(e,t){return Math.pow(t,1/e)}}]),t}()});