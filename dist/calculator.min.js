!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Calculator=t()}(this,function(){"use strict";function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}return function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._symbols={},this._definedOperator("+",this.last,"prefix",3),this._definedOperator("-",this.negation,"prefix",3),this._definedOperator("+",this.add,"infix",2),this._definedOperator("-",this.sub,"infix",2),this._definedOperator("*",this.multi,"infix",4),this._definedOperator("/",this.div,"infix",4),this._definedOperator("(",this.last,"prefix"),this._definedOperator(")",null,"postfix"),this._definedOperator("|",this.mod,"infix",4),this._definedOperator("!",this.fac,"postfix",6),this._definedOperator("^",Math.pow,"infix",5,!0),this._definedOperator("min",Math.min),this._definedOperator("max",Math.max),this._definedOperator(",",Array.of,"infix",1),this._definedOperator("%",this.rate,"postfix",6),this._definedOperator("cos",Math.cos),this._definedOperator("sin",Math.sin),this._definedOperator("tan",Math.tan),this._definedOperator("abs",Math.abs),this._definedOperator("log",this.log),this._definedOperator("//",this.sqrt,"infix",4),this.definedOperators(e.operators||[]),this.handleError="function"==typeof e.handleError?e.handleError:null,this.precision=!1!==e.precision,this._caches={}}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(t,[{key:"calcReg",value:function(){var e="\\d+(?:\\.\\d+)?|"+Object.values(this._symbols).sort(function(e,t){return t.symbol.length-e.symbol.length}).map(function(e){return e.symbol.replace(/[\\*+^()$?.{}|[\]]/g,"\\$&")}).join("|")+"|(\\S)";this.pattern=new RegExp(e,"g")}},{key:"_definedOperator",value:function(e,t,n,i,r){var o,a=2<arguments.length&&void 0!==n?n:"func",s=3<arguments.length&&void 0!==i?i:0,f=4<arguments.length&&void 0!==r&&r;"func"===a&&(s=0);var c="infix"===a?2:1;this._symbols[e]=Object.assign({},this._symbols[e],(h(o={},a,{symbol:e,handle:t?t.bind(this):t,precedence:s,argCount:c,type:a,right2left:f}),h(o,"symbol",e),o))}},{key:"definedOperators",value:function(e){var n=this;(e=Array.isArray(e)?e:[e]).map(function(e){if(-1===["(",")",","].indexOf(e.token)&&e.token&&e.func){var t=n._symbols[e.token];t&&(t.infix&&"postfix"===e.type||t.postfix&&"infix"===e.type)?console.warn("".concat(e.token,": infix and postfix operator should be mutually exclusive")):n._definedOperator(e.token,e.func,e.type,e.weight,e.rtol)}}),this.calcReg()}},{key:"parse",value:function(a){function e(e){var t,n;return"("!=e.symbol&&r.push(e),(n=e.handle.apply(e,g((t=[]).concat.apply(t,g(i.splice(-e.argCount)))))).code?n:(i.push(n),e.precedence)}function t(e,t){var n=s?s.index:a.length,i="[error code:".concat(e,"] ").concat(t," at ").concat(n,":\n").concat(a,"\n").concat(" ".repeat(n),"^");console.warn("".concat(i));var r={code:e,message:t,pos:n,token:f},o=c.handleError?c.handleError(r):r;return c._caches[a]=o}var s,f,c=this,n=[this._symbols["("].prefix],i=[],r=[],o=!1;a=a.replace(/\s/g,"");var h=this._caches[a];if(h)return h;this._caches[a]={},this.pattern.lastIndex=0;do{s=this.pattern.exec(a),f=s?s[0]:")";var u=this._symbols[f];if(s&&s[1])return t(1001,"".concat(s[1]," is undefined"));if(!o&&isNaN(f)&&(!u||u&&!u.prefix&&!u.func))return t(1002,"Syntax error");if(o){var p=u.postfix||u.infix,l=void 0;do{var d=n[n.length-1];if(0<(p.precedence-d.precedence||d.right2left))break;if("object"===y(l=e(n.pop())))return t(l.code,l.message)}while(l);o=")"!=p.symbol?"postfix"===p.type?(e(p),!0):(n.push(p),!1):"postfix"===p.type}else if(isNaN(+f)){if(n.push(u.prefix||u.func),u.func&&(!(s=this.pattern.exec(a))||"("!==s[0]))return t(1003,'Missing a opening parenthesis after function "'.concat(f,'"'))}else o=!0,i.push(+f),r.push(+f)}while(s&&n.length);return n.length?t(1004,"Opening parenthesis is more than closing parenthesis"):s?t(1005,"Closing parenthesis is more than opening parenthesis"):this._caches[a]={notation:r,value:i.pop()}}},{key:"_rectify",value:function(e,t,n){var i,r,o;switch(e=e.toString(),t=t.toString(),i=(e.split(".")[1]||"").length,r=(t.split(".")[1]||"").length,n){case"+":return(e*(o=Math.pow(10,Math.max(i,r)))+t*o)/o;case"-":return(e*(o=Math.pow(10,Math.max(i,r)))-t*o)/o;case"*":return(e*=Math.pow(10,i))*(t*=Math.pow(10,r))/Math.pow(10,i+r);case"/":return(e*=Math.pow(10,i))/(t*=Math.pow(10,r))*Math.pow(10,r-i)}}},{key:"last",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.pop()}},{key:"negation",value:function(e){return-e}},{key:"add",value:function(e,t){return this.precision?this._rectify(e,t,"+"):e+t}},{key:"sub",value:function(e,t){return this.precision?this._rectify(e,t,"-"):e-t}},{key:"multi",value:function(e,t){return this.precision?this._rectify(e,t,"*"):e*t}},{key:"div",value:function(e,t){return 0===t?{code:1006,message:"The divisor cannot be zero"}:this.precision?this._rectify(e,t,"/"):e/t}},{key:"mod",value:function(e,t){return 0===t?{code:1006,message:"The divisor cannot be zero"}:e%t}},{key:"fac",value:function(e){if(e%1||!(0<=+e))return{code:1008,message:"The factorial base must be a non-negative integer"};if(170<e)return 1/0;for(var t=1;1<e;)t*=e--;return t}},{key:"log",value:function(e,t){return e<=0||1==e?{code:1007,message:"The base number of logarithmic operations must be greater than 0 and not equal to 1"}:Math.log(t)/Math.log(e)}},{key:"rate",value:function(e){return this._rectify(e,100,"/")}},{key:"sqrt",value:function(e,t){return Math.pow(t,1/e)}}]),t}()});