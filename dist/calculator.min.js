!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Calculator=t()}(this,function(){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._symbols={},this._definedOperator("+",this.last,"prefix",3),this._definedOperator("-",this.negation,"prefix",3),this._definedOperator("+",this.add,"infix",2),this._definedOperator("-",this.sub,"infix",2),this._definedOperator("*",this.multi,"infix",4),this._definedOperator("/",this.div,"infix",4),this._definedOperator("(",this.last,"prefix"),this._definedOperator(")",null,"postfix"),this._definedOperator("|",this.mod,"infix",4),this._definedOperator("!",this.fac,"postfix",6),this._definedOperator("^",Math.pow,"infix",4,!0),this._definedOperator("min",Math.min),this._definedOperator("max",Math.max),this._definedOperator(",",Array.of,"infix",1),this._definedOperator("%",this.rate,"postfix",6),this._definedOperator("cos",Math.cos),this._definedOperator("sin",Math.sin),this._definedOperator("tan",Math.tan),this._definedOperator("abs",Math.abs),this._definedOperator("log",this.log),this._definedOperator("//",this.sqrt,"infix",4),this.calcReg(),this._caches={}}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"calcReg",value:function(){var e="\\d+(?:\\.\\d+)?|"+Object.values(this._symbols).sort(function(e,t){return t.symbol.length-e.symbol.length}).map(function(e){return e.symbol.replace(/[\\*+^()$?.{}|[\]]/g,"\\$&")}).join("|")+"|(\\S)";this.pattern=new RegExp(e,"g")}},{key:"_definedOperator",value:function(e,t,n,r,i){var o,a=2<arguments.length&&void 0!==n?n:"func",s=3<arguments.length&&void 0!==r?r:0,f=4<arguments.length&&void 0!==i&&i;"func"===a&&(s=0);var c="infix"===a?2:1;this._symbols[e]=Object.assign({},this._symbols[e],(u(o={},a,{symbol:e,handle:t,precedence:s,argCount:c,type:a,right2left:f}),u(o,"symbol",e),o))}},{key:"definedOperators",value:function(e){var n=this;(e=Array.isArray(e)?e:[e]).map(function(e){if(-1===["(",")",","].indexOf(e.token)){var t=n._symbols[e.token];t&&(t.infix&&"postfix"===e.type||t.postfix&&"infix"===e.type)?console.warn("".concat(e.token,": infix and postfix operator should be mutually exclusive")):n._definedOperator(e.token,e.func,e.type,e.weight,e.rtol)}}),this.calcReg()}},{key:"parse",value:function(o){function e(e){var t;return"("!=e.symbol&&f.push(e),i.push(e.handle.apply(e,d((t=[]).concat.apply(t,d(i.splice(-e.argCount)))))),e.precedence}function t(e,t){var n=a?a.index:o.length,r="[error code:".concat(e,"] ").concat(t," at ").concat(n,":\n").concat(o,"\n").concat(" ".repeat(n),"^");console.warn("".concat(r));var i={code:e,message:t};return s._caches[o].err=i}var a,n,s=this,r=[this._symbols["("].prefix],i=[],f=[],c=!1;o=o.replace(/\s/g,"");var u=this._caches[o];if(u)return u.err?t(u.err.code,u.err.message):u;this._caches[o]={},this.pattern.lastIndex=0;do{n=(a=this.pattern.exec(o))?a[0]:")";var h=this._symbols[n];if(a&&a[1])return t(1001,"".concat(a[1]," is undefined"));if(!c&&isNaN(n)&&(!h||h&&!h.prefix&&!h.func))return t(1002,"Syntax error");if(c){var l=h.postfix||h.infix;do{var p=r[r.length-1];if(0<(l.precedence-p.precedence||p.right2left))break}while(e(r.pop()));c=")"!=l.symbol?"postfix"===l.type?(e(l),!0):(r.push(l),!1):"postfix"===l.type}else if(isNaN(+n)){if(r.push(h.prefix||h.func),h.func&&(!(a=this.pattern.exec(o))||"("!==a[0]))return t(1003,'Missing a opening parenthesis after function "'.concat(n,'"'))}else c=!0,i.push(+n),f.push(+n)}while(a&&r.length);return r.length?t(1004,"Opening parenthesis is more than closing parenthesis"):a?t(1005,"Closing parenthesis is more than opening parenthesis"):this._caches[o]={notation:f,value:i.pop()}}},{key:"last",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.pop()}},{key:"negation",value:function(e){return-e}},{key:"add",value:function(e,t){return e+t}},{key:"sub",value:function(e,t){return e-t}},{key:"multi",value:function(e,t){return e*t}},{key:"div",value:function(e,t){if(0===t)throw new Error("The divisor cannot be zero");return e/t}},{key:"mod",value:function(e,t){if(0===t)throw new Error("The divisor cannot be zero");return e%t}},{key:"fac",value:function(e){if(e%1||!(0<=+e))return NaN;if(170<e)return 1/0;for(var t=1;1<e;)t*=e--;return t}},{key:"log",value:function(e,t){if(e<=0||1==e)throw new Error("The base number of logarithmic operations must be greater than 0 and not equal to 1");return Math.log(t)/Math.log(e)}},{key:"rate",value:function(e){return e/100}},{key:"sqrt",value:function(e,t){return Math.pow(t,1/e)}}]),e}()});