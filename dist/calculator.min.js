"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var Calculator=function(){function e(){_classCallCheck(this,e),this._symbols={},this._definedOperator("+",this.last,"prefix",3),this._definedOperator("-",this.negation,"prefix",3),this._definedOperator("+",this.add,"infix",2),this._definedOperator("-",this.sub,"infix",2),this._definedOperator("*",this.multi,"infix",4),this._definedOperator("/",this.div,"infix",4),this._definedOperator("(",this.last,"prefix"),this._definedOperator(")",null,"postfix"),this._definedOperator("|",this.mod,"infix",4),this._definedOperator("!",this.fac,"postfix",6),this._definedOperator("^",Math.pow,"infix",4,!0),this._definedOperator("min",Math.min),this._definedOperator("max",Math.max),this._definedOperator(",",Array.of,"infix",1),this._definedOperator("%",this.rate,"postfix",6),this._definedOperator("cos",Math.cos),this._definedOperator("sin",Math.sin),this._definedOperator("tan",Math.tan),this._definedOperator("abs",Math.abs),this._definedOperator("log",this.log),this._definedOperator("âˆš",this.sqrt,"infix",6),this.calcReg(),this._caches={}}return _createClass(e,[{key:"calcReg",value:function(){var e="\\d+(?:\\.\\d+)?|"+Object.values(this._symbols).sort(function(e,t){return t.symbol.length-e.symbol.length}).map(function(e){return e.symbol.replace(/[\\*+^()$?.{}|[\]]/g,"\\$&")}).join("|")+"|(\\S)";this.pattern=new RegExp(e,"g")}},{key:"_definedOperator",value:function(e,t,r,n,i){var a,o=2<arguments.length&&void 0!==r?r:"func",s=3<arguments.length&&void 0!==n?n:0,f=4<arguments.length&&void 0!==i&&i;"func"===o&&(s=0);var c="infix"===o?2:1;this._symbols[e]=Object.assign({},this._symbols[e],(_defineProperty(a={},o,{symbol:e,handle:t,precedence:s,argCount:c,type:o,right2left:f}),_defineProperty(a,"symbol",e),a))}},{key:"definedOperators",value:function(e){var r=this;(e=Array.isArray(e)?e:[e]).map(function(e){if(-1===["(",")",","].indexOf(e.token)){var t=r._symbols[e.token];t&&(t.infix&&"postfix"===e.type||t.postfix&&"infix"===e.type)?console.warn("".concat(e.token,": infix and postfix operator should be mutually exclusive")):r._definedOperator(e.token,e.func,e.type,e.weight,e.rtol)}}),this.calcReg()}},{key:"parse",value:function(a){function e(e){var t;return"("!=e.symbol&&f.push(e),i.push(e.handle.apply(e,_toConsumableArray((t=[]).concat.apply(t,_toConsumableArray(i.splice(-e.argCount)))))),e.precedence}function t(e,t){var r=o?o.index:a.length,n="[error code:".concat(e,"] ").concat(t," at ").concat(r,":\n").concat(a,"\n").concat(" ".repeat(r),"^");console.warn("".concat(n));var i={code:e,message:t};return s._caches[a].err=i}var o,r,s=this,n=[this._symbols["("].prefix],i=[],f=[],c=!1;a=a.replace(/\s/g,"");var l=this._caches[a];if(l)return l.err?t(l.err.code,l.err.message):l;this._caches[a]={},this.pattern.lastIndex=0;do{r=(o=this.pattern.exec(a))?o[0]:")";var u=this._symbols[r];if(o&&o[1])return t(1001,"".concat(o[1]," is undefined"));if(!c&&isNaN(r)&&(!u||u&&!u.prefix&&!u.func))return t(1002,"Syntax error");if(c){var h=u.postfix||u.infix;do{var p=n[n.length-1];if(0<(h.precedence-p.precedence||p.right2left))break}while(e(n.pop()));c=")"!=h.symbol?"postfix"===h.type?(e(h),!0):(n.push(h),!1):"postfix"===h.type}else if(isNaN(+r)){if(n.push(u.prefix||u.func),u.func&&(!(o=this.pattern.exec(a))||"("!==o[0]))return t(1003,'Missing a opening parenthesis after function "'.concat(r,'"'))}else c=!0,i.push(+r),f.push(+r)}while(o&&n.length);return n.length?t(1004,"Opening parenthesis is more than closing parenthesis"):o?t(1005,"Closing parenthesis is more than opening parenthesis"):this._caches[a]={notation:f,value:i.pop()}}},{key:"last",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.pop()}},{key:"negation",value:function(e){return-e}},{key:"add",value:function(e,t){return e+t}},{key:"sub",value:function(e,t){return e-t}},{key:"multi",value:function(e,t){return e*t}},{key:"div",value:function(e,t){if(0===t)throw new Error("The divisor cannot be zero");return e/t}},{key:"mod",value:function(e,t){if(0===t)throw new Error("The divisor cannot be zero");return e%t}},{key:"fac",value:function(e){if(e%1||!(0<=+e))return NaN;if(170<e)return 1/0;for(var t=1;1<e;)t*=e--;return t}},{key:"log",value:function(e,t){if(e<=0||1==e)throw new Error("The base number of logarithmic operations must be greater than 0 and not equal to 1");return Math.log(t)/Math.log(e)}},{key:"rate",value:function(e){return e/100}},{key:"sqrt",value:function(e,t){return Math.pow(t,1/e)}}]),e}();